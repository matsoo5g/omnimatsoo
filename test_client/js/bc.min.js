const POST_BACKEND="http://localhost:5000/collect/";function getVideoSrc(){source={1:window.location.origin,2:"http://cdn.dummy.com"},vid={1:"/vid/short.mp4"};const e=Object.fromEntries(new URLSearchParams(window.location.search).entries());return source[e.s||1]+vid[e.v||1]}const MediaEvents=["abort","canplay","canplaythrough","durationchange","complete","emptied","ended","error","loadeddata","loadedmetadata","loadstart","pause","play","playing","ratechange","suspend","seeked","seeking","stalled","volumechange","waiting"];async function postData(e="",t={}){await fetch(e,{method:"POST",mode:"no-cors",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},referrerPolicy:"no-referrer",body:JSON.stringify(t)})}window.addEventListener("DOMContentLoaded",()=>{video=document.querySelector("#video"),video.setAttribute("src",getVideoSrc());let e=[],t={samples:0,creationTimes:[],droppedVideoFrames:[],totalVideoFrames:[]};MediaEvents.forEach(t=>{video.addEventListener(t,t=>{e.push([performance.now(),t.type])})}),video.addEventListener("timeupdate",()=>{let e=video.getVideoPlaybackQuality();t.creationTimes.push(e.creationTime),t.totalVideoFrames.push(e.totalVideoFrames),t.droppedVideoFrames.push(e.droppedVideoFrames)}),video.addEventListener("ended",()=>{t.samples=t.creationTimes.length,postData(POST_BACKEND,{id:Math.floor(performance.now()%65536).toString(16)+Math.floor(16777216*(1+Math.random())).toString(16).substring(1),timestamp:Date.now(),target:video.src,events:e,playbackquality:t})}),video.play()});